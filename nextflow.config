// Define DSL2
nextflow.enable.dsl=2


profiles {

    standard {

        process{
          executor = 'slurm'
          time='30days'
          //clusterOptions = '--nice 200' 
 withLabel: small_mem {
            cpus = 2
            memory = 20.GB
            queue = 'parallel'
            //queue = 'Posit-Slurm-x2idn-1024g-64'
        }

        withLabel: medium_mem {
            cpus = 32
            memory = 100.GB
            queue = 'parallel'
            //queue = 'Posit-Slurm-x2idn-1024g-64'
        }

        withLabel: big_mem {
            cpus = 32
            memory = 160.GB
            queue = 'parallel'
            //queue = 'Posit-Slurm-x2idn-1024g-64'
        }
        
        withLabel: gpu {
          cpus = 16
          memory = 120.GB
          queue = 'gpu'
          clusterOptions = '--gres=gpu:1 --constraint=gpu'
        }
        }

        
        //no benchmarking, initialise as blank
        params.dobenchmark = false
        params.cell_intervals = [1]
        params.protein_intervals = [1]

        //flags to turn on/off particular models
        params.do_scipenn = false
        params.do_speck = false
        params.do_seurat = false
        params.do_totalvi = false
        params.do_cTPnet = false
        params.do_BABEL = false
        params.do_scLinear = false
        params.do_scMMT = false
        params.do_scTranslator_finetune = false
        params.do_scTranslator_nofinetune = true
        params.do_scTranslator_fewshot = false
        
        params.Renv_yaml_dir= "$projectDir" + '/envs/default_Renv.yml'
        params.use_old_inputs="false"
        
    }

    benchmarking {
    
        process{
          executor = 'slurm'
          time='30days'
          //clusterOptions = '--nice 200' 
 withLabel: small_mem {
            cpus = 2
            memory = 20.GB
            queue = 'parallel'
            //queue = 'Posit-Slurm-x2idn-1024g-64'
        }

        withLabel: medium_mem {
            cpus = 32
            memory = 100.GB
            queue = 'parallel'
            //queue = 'Posit-Slurm-x2idn-1024g-64'
        }

        withLabel: big_mem {
            cpus = 32
            memory = 160.GB
            queue = 'parallel'
            //queue = 'Posit-Slurm-x2idn-1024g-64'
        }
        
        withLabel: gpu {
          cpus = 16
          memory = 120.GB
          queue = 'gpu'
          clusterOptions = '--gres=gpu:1 --constraint=gpu'
          beforeScript = '''
              export CUDA_VISIBLE_DEVICES=0
          '''
        }
        }


        params.dobenchmark = true

        //use this to define a random fraction of cells/proteins to use in training i.e. subsample the input data
        //params.protein_intervals = [0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50]
        //params.cell_intervals = [0.0625, 0.125, 0.25, 0.5, 1]
        params.cell_intervals = [1]

        
        params.protein_intervals = [1]

        //use this one to do leave-one-out analysis
        //params.cell_intervals = ['_B','_CD4 T','_CD8 T','_Mono','_DC','_NK']

        //use this to do one-type-only analysis
        //params.cell_intervals = ['B','CD4 T','CD8 T','Mono','DC','NK']

        params.outputdir = './'
        params.query_file = 'empty'

        //flags to turn on/off particular models
        params.do_scipenn = false
        params.do_speck = false
        params.do_seurat = false
        params.do_totalvi = false
        params.do_cTPnet = false
        params.do_BABEL = false
        params.do_scLinear= false
        params.do_scMMT= false
        params.do_scTranslator_finetune = false
        params.do_scTranslator_nofinetune = true
        params.do_scTranslator_fewshot = true
        params.Renv_yaml_dir= "$projectDir" + '/envs/default_Renv.yml'
        params.use_old_inputs="true"

    }





}


conda {
  enabled = true 
  cacheDir = "/shared-workspace/jfisher2/conda/nextflow_envs" 
  useMamba = false
  createTimeout = '5 h'
  createOptions = '-c conda-forge -c bioconda -c nvidia'
}



// nextflow.config
report {
    enabled = true
    file = "report"
    overwrite= true
}